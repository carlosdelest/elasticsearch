---
"Create component template with disabled data lifecycle":

  - do:
      catch: bad_request
      cluster.put_component_template:
        name: test-component-template
        body:
          template:
            lifecycle:
              data_retention: "10d"
              enabled: false
  - match: { status: 400 }
  - match: { error.root_cause.0.type: "illegal_argument_exception" }
  - match: { error.root_cause.0.reason: "data lifecycle cannot be disabled in serverless, please remove 'enabled=false'" }

---
"Create index template with disabled data lifecycle":

  - do:
      catch: bad_request
      indices.put_index_template:
        name: test-composable-template
        body:
          index_patterns: "my-data-stream"
          template:
            lifecycle:
              data_retention: "10d"
              enabled: false
          data_stream: {}
  - match: { status: 400 }
  - match: { error.root_cause.0.type: "illegal_argument_exception" }
  - match: { error.root_cause.0.reason: "data lifecycle cannot be disabled in serverless, please remove 'enabled=false'" }

---
"Disable data lifecycle on data stream":
  - do:
      indices.put_index_template:
        name: ds-template
        body:
          index_patterns: "my-data-stream"
          data_stream: { }
  - is_true: acknowledged

  - do:
      indices.create_data_stream:
        name: my-data-stream
  - is_true: acknowledged

  - do:
      catch: bad_request
      indices.put_data_lifecycle:
        name: "my-data-stream"
        body:
          enabled: false

  - match: { status: 400 }
  - match: { error.root_cause.0.type: "illegal_argument_exception" }
  - match: { error.root_cause.0.reason: "data lifecycle cannot be disabled in serverless, please remove 'enabled=false'" }

---
"Create component template with disabled failures lifecycle":

  - do:
      catch: bad_request
      cluster.put_component_template:
        name: test-component-template
        body:
          template:
            data_stream_options:
              failure_store:
                lifecycle:
                  data_retention: "10d"
                  enabled: false
  - match: { status: 400 }
  - match: { error.root_cause.0.type: "illegal_argument_exception" }
  - match: { error.root_cause.0.reason: "failures lifecycle cannot be disabled in serverless, please remove 'enabled=false'" }

---
"Create index template with disabled failures lifecycle":

  - do:
      catch: bad_request
      indices.put_index_template:
        name: test-composable-template
        body:
          index_patterns: "my-data-stream"
          template:
            data_stream_options:
              failure_store:
                lifecycle:
                  data_retention: "10d"
                  enabled: false
          data_stream: {}
  - match: { status: 400 }
  - match: { error.root_cause.0.type: "illegal_argument_exception" }
  - match: { error.root_cause.0.reason: "failures lifecycle cannot be disabled in serverless, please remove 'enabled=false'" }

---
"Disable failures lifecycle on data stream":
  - do:
      indices.put_index_template:
        name: ds-template
        body:
          index_patterns: "my-data-stream"
          data_stream: { }
  - is_true: acknowledged

  - do:
      indices.create_data_stream:
        name: my-data-stream
  - is_true: acknowledged

  - do:
      catch: bad_request
      indices.put_data_stream_options:
        name: "my-data-stream"
        body:
          failure_store:
            lifecycle:
              enabled: false

  - match: { status: 400 }
  - match: { error.root_cause.0.type: "illegal_argument_exception" }
  - match: { error.root_cause.0.reason: "failures lifecycle cannot be disabled in serverless, please remove 'enabled=false'" }

---
"Create component template with disabled data and failures lifecycle":

  - do:
      catch: bad_request
      cluster.put_component_template:
        name: test-component-template
        body:
          template:
            lifecycle:
              data_retention: "10d"
              enabled: false
            data_stream_options:
              failure_store:
                lifecycle:
                  enabled: false
  - match: { status: 400 }
  - match: { error.root_cause.0.type: "illegal_argument_exception" }
  - match: { error.root_cause.0.reason: "data and failures lifecycle cannot be disabled in serverless, please remove 'enabled=false'" }
